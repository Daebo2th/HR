<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="dev">
	<select id="searchTotal" parameterType="HashMap" resultType="com.kosa.hrsystem.vo.WorkScheduleVO">
		SELECT
            e.emp_num,
            e.emp_name,
            w.schedule,
            w.go_work,
            w.leave_work,
            t.work_name,
            t.work_sch_type_num,
            w.work_sch_num,
            d.code_name dept_code,
            d.code_value dept,
            r.code_name rank_code,
            r.code_value rank,
            w.remarks,
            round(
                (TO_DATE(to_char(
                    leave_work, 'HH24:MI'
                ), 'HH24:MI') - TO_DATE(to_char(
                    go_work, 'HH24:MI'
                ), 'HH24:MI')) * 24, 2
            )            totaltime
        FROM
            (
                (
                    work_schedule w
                    INNER JOIN work_schedule_type t ON w.work_sch_type_num = t.work_sch_type_num
                )
                INNER JOIN emp                e ON e.emp_num = w.emp_num
            )
            INNER JOIN code_table         d ON d.code_name = e.dept
            INNER JOIN code_table         r ON r.code_name = e.rank 
            where 1=1
            <choose>
                <when test = "searchType == 'empNum'.toString()">
                    AND e.emp_num like '%' || #{searchWord} || '%'
                </when>        
                <when test = "searchType == 'empName'.toString()">
                    AND emp_name like '%' || #{searchWord} || '%'
                </when>
                <when test = "searchType == 'workType'.toString()">
                    AND work_name like '%' || #{searchWord} || '%'
                </when>
                <when test = "searchType == 'rank'.toString()">
                    AND r.code_value like '%' || #{searchWord} || '%'
                </when>
            </choose>
            order by schedule desc
	</select>
	<select id="searchByDate" parameterType="HashMap" resultType="com.kosa.hrsystem.vo.WorkScheduleVO">
		SELECT
            e.emp_num,
            e.emp_name,
            w.schedule,
            w.go_work,
            w.leave_work,
            t.work_name,
            t.work_sch_type_num,
            w.work_sch_num,
            d.code_name dept_code,
            d.code_value dept,
            r.code_name rank_code,
            r.code_value rank,
            w.remarks,
            round(
                (TO_DATE(to_char(
                    leave_work, 'HH24:MI'
                ), 'HH24:MI') - TO_DATE(to_char(
                    go_work, 'HH24:MI'
                ), 'HH24:MI')) * 24, 2
            )            totaltime
        FROM
            (
                (
                    work_schedule w
                    INNER JOIN work_schedule_type t ON w.work_sch_type_num = t.work_sch_type_num
                )
                INNER JOIN emp                e ON e.emp_num = w.emp_num
            )
            INNER JOIN code_table         d ON d.code_name = e.dept
            INNER JOIN code_table         r ON r.code_name = e.rank 
            where schedule BETWEEN #{startDate} AND #{endDate} order by schedule desc
	</select>
	<select id="selectAllWorkSchedule" resultType="com.kosa.hrsystem.vo.WorkScheduleVO">
		SELECT
            e.emp_num,
            e.emp_name,
            w.schedule,
            w.go_work,
            w.leave_work,
            t.work_name,
            t.work_sch_type_num,
            w.work_sch_num,
            d.code_name dept_code,
            d.code_value dept,
            r.code_name rank_code,
            r.code_value rank,
            w.remarks,
            round(
                (TO_DATE(to_char(
                    leave_work, 'HH24:MI'
                ), 'HH24:MI') - TO_DATE(to_char(
                    go_work, 'HH24:MI'
                ), 'HH24:MI')) * 24, 2
            )            totaltime
        FROM
            (
                (
                    work_schedule w
                    INNER JOIN work_schedule_type t ON w.work_sch_type_num = t.work_sch_type_num
                )
                INNER JOIN emp                e ON e.emp_num = w.emp_num
            )
            INNER JOIN code_table         d ON d.code_name = e.dept
            INNER JOIN code_table         r ON r.code_name = e.rank 
	</select>
	<insert id="insertWorkSchedule" parameterType="com.kosa.hrsystem.dto.WorkScheduleDTO">
		insert into work_schedule values (ws_seq.nextval,#{work_sch_type_num},#{schedule},#{dept},#{rank},#{emp_num},#{go_work},#{leave_work},#{remarks})
	</insert>
	<update id="updateWorkSchedule" parameterType="com.kosa.hrsystem.dto.WorkScheduleDTO">
		update work_schedule set 
		    work_sch_type_num = #{work_sch_type_num},
		    schedule = #{schedule},
		    dept = #{dept},
		    rank = #{rank},
		    emp_num = #{emp_num},
		    go_work = #{go_work},
		    leave_work = #{leave_work},
		    remarks = #{remarks, jdbcType=VARCHAR}
		    where work_sch_num = #{work_sch_num}
	</update>
	<delete id="deleteWorkSchedule" parameterType="Integer">
		delete from work_schedule where work_sch_num = #{work_sch_num}
	</delete>
</mapper>

